<html>
<head>
<title>MyLog Unit Test Page</title>
<style type="text/css" rel="stylesheet">

body {font-family: Arial}

</style>
<script type="text/javascript" src="chrome://mylog/content/test/ecmaunit.js"> </script>
<script language="JavaScript" type="text/javascript" src="chrome://mylog/content/mylog.js"></script>
<script language="JavaScript" type="text/javascript" src="chrome://mylog/content/mylog-datastorage.js"></script>
<script language="JavaScript" type="text/javascript" src="chrome://mylog/content/mylog-searchwindow.js"></script>
<script type="text/javascript">
//<![CDATA[
// This test for a search that should return 4 results
    function MyLogTestCase() {
        this.name = 'MyLogTestCase';
        var handler,storage,entry;
        this.setUp = function() {
            /* not in use here, didn't have to define it but this might be
        used as a reference
        */
            storage = new XmlDataStore();
            storage.setXmlFilepath("mylog-tag-test.xml");
            handler = storage.open();
            entry = handler.getEntry(0);        
        }
    
        this.testGetAllTags = function() {
            var msg = "testGetAlltags";
            var tags = handler.getAllTags();
            var correctTags = ["blah", "Google", "blank"];
            var passed = 1;
            for (var i = 0; i < Math.max(tags.length, correctTags.length); i++) {
                    this.assertEquals(tags[i], correctTags[i]);
            }
        }
    
        this.testTagSearch1 = function() {
            var keyword = "blah";
            var correctEntryList = [0, 2, 3];
            var entryList = handler.findEntries(keyword,"tag");
            for (var i=0; i < Math.max(entryList.length, correctEntryList.length); i++) {
                    this.assertEquals(entryList[i].getId(), correctEntryList[i]);
            }
        }
    
        this.testTagSearch2 = function() {
            keyword = "Google";
            correctEntryList = [1];
            var entryList = handler.findEntries(keyword,"tag");
            for (var i=0; i < Math.max(entryList.length, correctEntryList.length); i++) {
                    this.assertEquals(entryList[i].getId(), correctEntryList[i]);
            }
        }
    
        this.testTagSearch3 = function() {
            keyword = "nothing";
            correctEntryList = [];
            var entryList = handler.findEntries(keyword,"tag");
            this.assertEquals(entryList.length,0);
        }

	    this.testSetTagAt = function() {
			entry.setTagAt(0,'New Tag');
			newTag = entry.getTags()[0];
			this.assertEquals(newTag, 'New Tag');
		}
	
		this.testRemoveTagAt = function() {
			entry.removeTagAt(0);
			newTags = entry.getTags();
			this.assertEquals(newTags.length, 0);
			
	        entry = handler.getEntry(3);     
	        entry.removeTagAt(1);			
	        newTags = entry.getTags();
			this.assertEquals(newTags.length, 1);
	        
		}
    
        this.tearDown = function() {
            /* not in use here, didn't have to define it but this might be
                used as a reference
            */
            storage.close(handler);
        };
    };    
    MyLogTestCase.prototype = new TestCase;

    function runTests() {
        placeholder = document.getElementById('placeholder');
        var testsuite = new TestSuite(new HTMLReporter(placeholder));
        testsuite.registerTest(MyLogTestCase);
        testsuite.runSuite();
    };
//]]>
</script>
</head>
<body onload="runTests()">
<h3>EcmaUnit tests for MyLog Tags</h3>
<div id="placeholder"> </div>
</body>
</html>