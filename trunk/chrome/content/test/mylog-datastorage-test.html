<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ECMAUnit Tests</title>
    <script language="JavaScript" type="text/javascript" src="chrome://mylog/content/mylog.js"></script>
    <script language="JavaScript" type="text/javascript" src="chrome://mylog/content/mylog-datastorage.js"></script>
    <script type="text/javascript" src="chrome://mylog/content/test/ecmaunit.js"> </script>
    <script type="text/javascript">
//<![CDATA[
        function TestTestCase() {
            this.name = 'TestTestCase';
            var le, dataHandler;
            var url, title, tags, comment1, comment2, commment3, commments;
         
            this.setUp = function() {
                /* not in use here, didn't have to define it but this might be
                used as a reference
                */
                url = "http://www.google.com";
                title = "Google search engine";
                tags = new Array("tag1","tag2","tag3");
                comments = new Array("comment1", "comment2", "comment3");

                le = new LogEntry();
                le.setUrl(url);
                le.setTitle(title);
                for (var i = 0; i < tags.length; i++) {
                        le.addTag(tags[i]);
                }
                for (var i = 0; i < comments.length; i++) {
                        le.addComment(comments[i]);
                }

                var doc = document.implementation.createDocument("", "", null);
                var entriesElem = doc.createElement("entries");
                entriesElem.setAttribute("counter", "0");
                doc.appendChild(entriesElem);

                dataHandler = new XmlDataHandler();
                dataHandler.setDomDoc(doc);
            };
            this.testAddEntry = function() {
                dataHandler.addEntry(le);
                var doc = dataHandler.getDomDoc();

                var entries = doc.getElementsByTagName("entries")[0];
                assertEquals("1", entries.getAttribute("counter"));

                var entry = entries.getElementsByTagName("entry")[0];
                this.assertEquals(url, entry.getElementsByTagName("url")[0].childNodes[0].nodeValue);
                this.assertEquals(title, entry.getElementsByTagName("title")[0].childNodes[0].nodeValue);

                var domTags = entry.getElementsByTagName("tags")[0];
                for (var i = 0; i < domTags.childNodes.length; i++) {
                        this.assertEquals(tags[i], domTags.childNodes[i].childNodes[0].nodeValue);
                }

                var domComments = entry.getElementsByTagName("comments")[0];
                for (var i = 0; i < domComments.childNodes.length; i++) {
                    this.assertEquals(comments[i], domComments.childNodes[i].childNodes[0].nodeValue);
                }
            };
            
            this.testRemoveEntry = function() {
                dataHandler.addEntry(le);
                dataHandler.removeEntry(0);
    
                var doc = dataHandler.getDomDoc();
                var entries = doc.getElementsByTagName("entries")[0];
                var entryList = entries.getElementsByTagName("entry");
    
                var exists = 0;
                for (var i = 0; i < entryList.length; i++){
                        if (entryList[i].getAttribute("id") == "0") {
                                exists = 1;
                        }
                }
                this.assertEquals(0, exists);
            }
            
            this.tearDown = function() {
                /* not in use here, didn't have to define it but this might be
                used as a reference
                */
            };
        };
        TestTestCase.prototype = new TestCase;

        function runTests() {
            placeholder = document.getElementById('placeholder');
            var testsuite = new TestSuite(new HTMLReporter(placeholder));
            testsuite.registerTest(TestTestCase);
            testsuite.runSuite();
        }
//]]>
</script>
</head>

<body onload="runTests()">
<h3>EcmaUnit tests for MyLog datastorage</h3>
<div id="placeholder"> </div>
</body>
</html>
